<form (ngSubmit)="onSearch()" class="mb-4 flex gap-2">
  <input
    [(ngModel)]="searchTerm"
    name="search"
    placeholder="Buscar personaje"
    class="p-2 border rounded w-full"
  />
  <button class="bg-blue-500 text-white px-4 rounded">Buscar</button>
</form>

<div class="mb-4 flex flex-wrap gap-4 items-center text-sm">
  <label>
    Ordenar por:
    <select
      [(ngModel)]="orderBy"
      name="orderBy"
      class="ml-2 p-1 border rounded"
      (change)="onSearch()"
    >
      <option value="name">Nombre</option>
      <option value="-name">Nombre (desc)</option>
      <option value="modified">Modificado</option>
      <option value="-modified">Modificado (desc)</option>
    </select>
  </label>

  <label class="flex items-center gap-1">
    <input
      type="checkbox"
      [(ngModel)]="onlyWithDescription"
      name="onlyWithDescription"
      (change)="onSearch()"
    />
    Solo con descripción
  </label>

  <label class="flex items-center gap-1">
    Modificado desde:
    <input
      type="date"
      [(ngModel)]="modifiedSince"
      name="modifiedSince"
      class="p-1 border rounded"
      (change)="onSearch()"
    />
  </label>
  <button
    (click)="clearFilters()"
    class="text-sm text-blue-600 underline hover:text-blue-800"
  >
    Limpiar filtros
  </button>
</div>

<div class="grid grid-cols-2 md:grid-cols-4 gap-4" *ngIf="!loading">
  <div *ngFor="let char of characters" class="relative">
    <a
      [routerLink]="['/personaje', char.id]"
      class="block border rounded p-2 shadow text-center hover:bg-gray-50 transition"
    >
      <img
        [src]="char.thumbnail.path + '.' + char.thumbnail.extension"
        [alt]="char.name"
        class="w-full h-48 object-cover rounded mb-2"
      />
      <h3 class="font-semibold">{{ char.name }}</h3>
    </a>

    <button
      (click)="toggleFavorite(char); $event.stopPropagation(); $event.preventDefault()"
      class="absolute top-2 right-2 text-xl z-10"
      [disabled]="pending.has(char.id)"
    >
      <span
        [ngClass]="{
          'text-red-500': favorites.has(char.id),
          'text-gray-400': !favorites.has(char.id),
          'animate-pulse': pending.has(char.id)
        }"
      >
        ♥
      </span>
    </button>
  </div>
</div>

<div class="flex justify-between items-center mt-6 text-sm">
  <button
    (click)="prevPage()"
    [disabled]="offset === 0"
    class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
  >
    Anterior
  </button>

  <span class="text-gray-600"
    >Página {{ currentPage }} de {{ totalPages }}</span
  >

  <button
    (click)="nextPage()"
    [disabled]="offset + limit >= total"
    class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
  >
    Siguiente
  </button>
</div>
